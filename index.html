<!DOCTYPE html>
<html>

<head>
    <title>Github Homepage</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js"></script>
    <script src="https://fb.me/react-0.13.3.min.js"></script>
    <script src="https://fb.me/react-with-addons-0.13.3.min.js"></script>
    <script src="https://fb.me/JSXTransformer-0.13.3.js"></script>
    <link rel="stylesheet" href="src/style.css" media="screen" title="no title" charset="utf-8">
</head>

<body>
    <div class="component-block">
        <div id="finviz-charts">
        </div>
    </div>

    <div class="component-block">
        <div id="hacker_news-topStories">
        </div>
    </div>

    <script type="text/javascript" src="src/services.js"></script>
    <script type="text/javascript" src="src/filters.js"></script>
    <script type="text/javascript" src="src/components.js"></script>

    <script type="text/javascript">
        'use strict';
        $('.component-block').each(function(indx, elem){
            var el = $(elem),
                shrunk = true,
                shrunkHeight = '1.4em',
                firstChild = el.children().first(),
                firstId = firstChild.attr('id'),
                dotPath = firstId.replace('-','.'),
                titleBlock = $('<div class="component-block-title">');

            $('<button>+</button>')
                .click(function(evt){
                    if(shrunk){
                        el.css('height','');
                        evt.target.innerText = '-';
                    } else {
                        el.css('height',shrunkHeight);
                        evt.target.innerText = '+';
                    }
                    shrunk = !shrunk;
                })
                .appendTo(titleBlock);

            $('<button>Refresh</button>')
                .click(function(evt){
                    console.log(dotPath);
                    _.get(components, dotPath)($(firstChild));
                })
                .appendTo(titleBlock);

            $('<span>'+dotPath+'</span>')
                .appendTo(titleBlock);

            el.prepend(titleBlock);

            shrunkHeight = titleBlock.outerHeight();
            el.css({
                height: shrunkHeight,
                overflow: 'hidden'
            });
        });
        setTimeout(function() {
            components.hacker_news.topStories($('#hacker_news-topStories'));
            components.finviz.charts($('#finviz-charts'));
        }, 1);
    </script>

</body>

</html>
